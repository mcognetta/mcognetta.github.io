@def title = "Lichess Combined Puzzle-Game Database"
@def date = "09/22/2022"
@def tags = ["julia", "chess", "lichess"]

@def rss_pubdate = Date(2022, 09, 22)

# Lichess Combined Puzzle-Game Database

*TLDR: A database containing Lichess puzzles joined with their game information can be found [here](https://github.com/mcognetta/lichess-combined-puzzle-db).*

Recently I have been wrapping the [Lichess API](https://lichess.org/api) in Julia (there are a few [existing options](https://lichess.org/api#section/Introduction/Clients) in other languages, if you are interested). To test that everything is working well, I wanted to try a few small projects. The first one I am doing is related to the [Puzzle Database](https://database.lichess.org/#puzzles), which contains ~2.8 million puzzles generated from real Lichess games (the repo is [here](https://github.com/ornicar/lichess-puzzler/tree/master/generator), and an interesting article about automatic puzzle generation can be found [here](https://blog.playmagnus.com/generating-tactical-puzzles-with-stockfish-and-chess-jl-part-i/)).

The puzzle database only provides an identifier specifying the game that a puzzle was derived from as well as what ply the puzzle starts at, but it does not contain the actual game information (PGN, player ratings, result, etc.). All of the game information could be extracted from the [Lichess Game Database](https://database.lichess.org/#standard_games), but there are more than 3.6 billion games (939 GB on disk) at the time of writing. Furthermore, the games are batched by month, but the puzzle database does not contain any time information, so to find the games, every month's games would have to be downloaded and scanned.

Instead, I elected to use the Lichess API to [extract games by ID](https://lichess.org/api#tag/Games/operation/gamesExportIds). This allows you to extract a batch of games directly from the Lichess database, and was a nice test for my Julia API wrapper.

Unfortunately, the batch-extraction endpoint only allows batches of 300 games, and Lichess requests that you only make one API call at a time. For a sense of scale, at 5 seconds per call, this would take ~13 hours. So that others donâ€™t have to go through this, I joined the games with the puzzle database and have published it to a [public Github repo](https://github.com/mcognetta/lichess-combined-puzzle-db). It contains all 2.8 million puzzles as well as their games, with all of the [API flags](https://lichess.org/api#tag/Games/operation/gamesExportIds) enabled. They are provided in `bz2` compressed batches of 200,000 games in [ndjson format](http://ndjson.org/). Each line contains a JSON object with two top-level fields, `game` and `puzzle`, containing the game information extracted from the API and the puzzle information extracted from the puzzle database (with field names being derived from the csv headers), respectively. An example entry is given below:

```
{"puzzle":{"Themes":"crushing kingsideAttack long middlegame pin","OpeningFamily":"","Popularity":"100","NbPlays":"1","PuzzleId":"002rd","FEN":"r6k/q1pb1p1p/1b3Pr1/p1ppP2Q/3P2p1/4B3/PP2NRPP/3R2K1 b - - 1 25","Moves":"d7e6 e2f4 c5d4 f4g6 f7g6 h5h6","Rating":"1500","RatingDeviation":"500","GameUrl":"https://lichess.org/NcD6lul8/black#50"},"game":{"createdAt":1652296484864,"variant":"standard","status":"resign","pgn":"[Event \"Rated Blitz game\"]\n[Site \"https://lichess.org/NcD6lul8\"]\n[Date \"2022.05.11\"]\n[White \"morteza0521\"]\n[Black \"salirbeber\"]\n[Result \"1-0\"]\n[UTCDate \"2022.05.11\"]\n[UTCTime \"19:14:44\"]\n[WhiteElo \"2164\"]\n[BlackElo \"2270\"]\n[WhiteRatingDiff \"+7\"]\n[BlackRatingDiff \"-7\"]\n[Variant \"Standard\"]\n[TimeControl \"180+0\"]\n[ECO \"C44\"]\n[Opening \"Scotch Game: Scotch Gambit, Advance Variation\"]\n[Termination \"Normal\"]\n[Annotator \"lichess.org\"]\n\n1. e4 e5 2. Nf3 Nc6 3. d4 exd4 4. Bc4 Nf6 5. e5 { C44 Scotch Game: Scotch Gambit, Advance Variation } d5 6. Bb5 Ne4 7. Nxd4 Bd7 8. Bxc6 bxc6 9. O-O Bc5 10. c3 O-O 11. f3 Ng5 12. f4 Ne6 13. Be3 Nxd4 14. cxd4 Bb6 15. f5 a5 16. f6 g6 17. Qf3 Kh8 18. Qf4 Qb8 19. Qh6 Rg8 20. Rf4 g5 21. Rf2 Rg6 22. Qh5 g4 23. Nc3 Qa7 24. Rd1 c5 25. Ne2 Be6 26. Nf4 Rag8 27. Nxe6 fxe6 28. f7 Rf8 29. Bh6 cxd4 30. Bxf8 d3 31. Bg7+ { Black resigns. } 1-0\n\n\n","id":"NcD6lul8","clock":{"increment":0,"totalTime":180,"initial":180},"rated":true,"players":{"white":{"rating":2164,"user":{"name":"morteza0521","id":"morteza0521"},"ratingDiff":7},"black":{"rating":2270,"user":{"name":"salirbeber","id":"salirbeber"},"ratingDiff":-7}},"winner":"white","moves":"e4 e5 Nf3 Nc6 d4 exd4 Bc4 Nf6 e5 d5 Bb5 Ne4 Nxd4 Bd7 Bxc6 bxc6 O-O Bc5 c3 O-O f3 Ng5 f4 Ne6 Be3 Nxd4 cxd4 Bb6 f5 a5 f6 g6 Qf3 Kh8 Qf4 Qb8 Qh6 Rg8 Rf4 g5 Rf2 Rg6 Qh5 g4 Nc3 Qa7 Rd1 c5 Ne2 Be6 Nf4 Rag8 Nxe6 fxe6 f7 Rf8 Bh6 cxd4 Bxf8 d3 Bg7+","opening":{"name":"Scotch Game: Scotch Gambit, Advance Variation","eco":"C44","ply":9},"perf":"blitz","speed":"blitz","lastMoveAt":1652296756535}}
```

This database is provided under the same [Creative Commons CC0 license](https://tldrlegal.com/license/creative-commons-cc0-1.0-universal) as the Lichess databases.

A future post will detail the Julia Lichess API wrapper and some of the projects I have been using it for.