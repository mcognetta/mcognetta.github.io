<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/poole_lanyon.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/favicon.png"> <title>Franklin.jl Utils Examples: Tags Ordered by Post Quantity</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>theoretically good with computers</a>.</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/">home</a> <a class="sidebar-nav-item " href="/posts/">posts</a> <a class="sidebar-nav-item " href="https://dblp1.uni-trier.de/pers/hd/c/Cognetta:Marco">publications</a> <a class="sidebar-nav-item " href="https://github.com/mcognetta">github</a> <a class="sidebar-nav-item " href="https://www.linkedin.com/in/mcognetta/">linkedin</a> <a class="sidebar-nav-item " href="assets/mccv.pdf">cv</a> <a class="sidebar-nav-item " href="/tags">all tags</a> </nav> <div class=sidebar-item > <p>&copy; Marco Cognetta.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/" title=Home >Marco Cognetta</a> <small>theoretically good with computers</small> </h3> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=franklinjl_utils_examples_tags_ordered_by_post_quantity ><a href="#franklinjl_utils_examples_tags_ordered_by_post_quantity">Franklin.jl Utils Examples: Tags Ordered by Post Quantity</a></h1> <p>Franklin.jl provides a way for the user to execute arbitrary Julia functions on the markdown/html/LaTeX used in a page. For example, on my <a href="/posts">posts</a> page, all of the posts I have written are listed in order of publication date. This was done with a simple function:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> hfun_recent_posts(m::<span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >String</span>})
  <span class=hljs-meta >@assert</span> length(m) == <span class=hljs-number >1</span> <span class=hljs-string >&quot;only one argument allowed for recent posts (the number of recent posts to pull)&quot;</span>
  n = parse(<span class=hljs-built_in >Int64</span>, m[<span class=hljs-number >1</span>])
  list = readdir(<span class=hljs-string >&quot;posts&quot;</span>)
  filter!(f -&gt; endswith(f, <span class=hljs-string >&quot;.md&quot;</span>) &amp;&amp; f != <span class=hljs-string >&quot;index.md&quot;</span> , list)
  markdown = <span class=hljs-string >&quot;&quot;</span>
  posts = []
  df = <span class=hljs-built_in >DateFormat</span>(<span class=hljs-string >&quot;mm/dd/yyyy&quot;</span>)
  <span class=hljs-keyword >for</span> (k, post) <span class=hljs-keyword >in</span> enumerate(list)
      fi = <span class=hljs-string >&quot;posts/&quot;</span> * splitext(post)[<span class=hljs-number >1</span>]
      title = pagevar(fi, :title)
      datestr = pagevar(fi, :date)
      <span class=hljs-meta >@assert</span> length(datestr) == <span class=hljs-number >10</span>  <span class=hljs-string >&quot;dates must be in mm/dd/yyyy format&quot;</span>
      date = <span class=hljs-built_in >Date</span>(pagevar(fi, :date), df)
      push!(posts, (title=title, link=fi, date=date))
  <span class=hljs-keyword >end</span>

  <span class=hljs-comment ># pull all posts if n &lt;= 0</span>
  n = n &gt;= <span class=hljs-number >0</span> ? n : length(posts)+<span class=hljs-number >1</span>
  <span class=hljs-keyword >for</span> ele <span class=hljs-keyword >in</span> sort(posts, by=x-&gt;x.date, rev=<span class=hljs-literal >true</span>)[<span class=hljs-number >1</span>:min(length(posts), n)]
    markdown *= <span class=hljs-string >&quot;* [(<span class=hljs-subst >$(ele.date)</span>) <span class=hljs-subst >$(ele.title)</span>](../<span class=hljs-subst >$(ele.link)</span>)\n&quot;</span>
  <span class=hljs-keyword >end</span>

  <span class=hljs-keyword >return</span> fd2html(markdown, internal=<span class=hljs-literal >true</span>)
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> hfun_all_posts()
  <span class=hljs-keyword >return</span> hfun_recent_posts([<span class=hljs-string >&quot;-1&quot;</span>])
<span class=hljs-keyword >end</span></code></pre> <p>which is called in the <code>posts.md</code> file &#40;below is the <em>complete</em> file&#41;:</p> <pre><code class="markdown hljs"><span class=hljs-section ># all posts</span>

{{ all<span class=hljs-emphasis >_posts }}</span></code></pre> <p>This code can be executed as soon as the page generation starts, as it only relies on knowing local information from each page that can be retrieved and discarded when a page is looked at. When I was considering switching to Franklin, I ran into a problem where the code in <code>utils.jl</code> was being run before enough information was available for it to succeed. In particular, I wished to generate a list of tags ordered by the number of posts with that tag. This list would appear in the sidebar for each page, meaning it was generated at the same time that the page was processed &#40;and <code>utils.jl</code> code was run&#41;, but the tag information was also collected at this time. This led to a situation where incomplete tag information was being presented on pages.</p> <p>I discussed this on the Franklin slack and submitted an <a href="https://github.com/tlienart/Franklin.jl/issues/582">issue</a>. It was resolved after a short time by introducing a <code>@delay</code> macro, that delays the function execution until after a full pass of the website has been done &#40;at which time, all of the relevant global values–like tag information–would be known&#41;.</p> <p><a href="https://github.com/tlienart/Franklin.jl">Franklin.jl&#39;s GitHub</a> and <a href="https://franklinjl.org/">website</a> provide snippets for </p> <div class=page-foot > <div class=copyright > &copy; Marco Cognetta. Last modified: September 28, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> </div> </div> </div> </div> <label for=sidebar-checkbox  class=sidebar-toggle ></label>